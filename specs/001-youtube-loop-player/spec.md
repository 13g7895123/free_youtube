# Feature Specification: YouTube Loop Player

**Feature Branch**: `001-youtube-loop-player`
**Created**: 2025-10-22
**Status**: Draft
**Input**: User description: "核心目標為建立一個貼上youtube網址即可播放的播放器，且會循環播放"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - Paste and Play YouTube Video (Priority: P1)

使用者想要快速播放 YouTube 影片，只需貼上網址就能立即開始觀看，無需複雜操作。

**Why this priority**: 這是最核心的功能，提供基本的貼上網址並播放的能力。沒有這個功能，整個應用程式就失去存在意義。這是 MVP 的最小可行單位。

**Independent Test**: 可以通過貼上任何有效的 YouTube 網址並驗證影片能否開始播放來獨立測試此功能。成功標準是影片載入並開始播放。

**Acceptance Scenarios**:

1. **Given** 使用者開啟播放器應用程式，**When** 使用者貼上有效的 YouTube 網址（例如 https://www.youtube.com/watch?v=dQw4w9WgXcQ）並按下播放或送出，**Then** 影片應該在 3 秒內開始播放
2. **Given** 使用者已經在播放一部影片，**When** 使用者貼上新的 YouTube 網址，**Then** 當前影片應停止，新影片應該開始載入並播放
3. **Given** 使用者貼上無效的 YouTube 網址（例如錯誤格式的網址），**When** 使用者嘗試播放，**Then** 系統應顯示清楚的錯誤訊息，說明網址格式不正確
4. **Given** 使用者貼上的 YouTube 影片已被移除或無法存取，**When** 系統嘗試載入影片，**Then** 應顯示友善的錯誤訊息，說明影片無法播放

---

### User Story 2 - Automatic Loop Playback (Priority: P1)

使用者希望影片能夠自動循環播放，當影片結束時自動重新開始，無需手動重播。

**Why this priority**: 循環播放是此應用程式的核心需求之一，與貼上播放功能同等重要。這個功能使得應用程式區別於一般的 YouTube 嵌入播放器。對於需要重複觀看的情境（例如學習、背景音樂）至關重要。

**Independent Test**: 可以通過播放一部短影片（例如 30 秒）並觀察影片結束後是否自動重新開始來測試。成功標準是影片至少循環播放 2 次而無需使用者介入。

**Acceptance Scenarios**:

1. **Given** 使用者正在播放一部 YouTube 影片，**When** 影片播放到結尾，**Then** 影片應該自動從頭開始重新播放，無需使用者點擊任何按鈕
2. **Given** 循環播放功能已啟用，**When** 影片循環播放超過 10 次，**Then** 影片仍應繼續循環，不會停止或出現錯誤
3. **Given** 使用者正在循環播放影片，**When** 使用者貼上新的 YouTube 網址，**Then** 新影片應該開始播放並繼續循環

---

### User Story 3 - Basic Playback Controls (Priority: P2)

使用者需要基本的播放控制功能，包括暫停、繼續播放和調整音量，以便更好地控制觀看體驗。

**Why this priority**: 雖然不是最核心的功能，但基本的播放控制能大幅提升使用者體驗。這讓使用者能夠在需要時暫停影片，或調整音量以適應環境。

**Independent Test**: 可以通過播放影片並測試暫停、繼續和音量調整按鈕來獨立驗證。成功標準是所有控制按鈕都能正常運作且立即響應。

**Acceptance Scenarios**:

1. **Given** 影片正在播放，**When** 使用者點擊暫停按鈕，**Then** 影片應該立即暫停，並且暫停按鈕應變更為播放按鈕
2. **Given** 影片已暫停，**When** 使用者點擊播放按鈕，**Then** 影片應該從暫停的位置繼續播放
3. **Given** 影片正在播放，**When** 使用者調整音量滑桿，**Then** 影片音量應該即時改變，並且音量設定應該保留到下一部影片
4. **Given** 使用者調整音量為靜音，**When** 影片循環播放或載入新影片，**Then** 靜音設定應該保持，不會自動取消

---

### User Story 4 - Loop Toggle Control (Priority: P3)

使用者希望能夠開啟或關閉循環播放功能，以便在需要時播放影片一次後停止。

**Why this priority**: 這是一個增強功能，提供更多彈性。雖然預設行為是循環播放，但有些使用者可能只想播放一次。這個功能優先級較低，因為預設的循環播放已經滿足核心需求。

**Independent Test**: 可以通過切換循環開關並觀察影片結束後的行為來測試。成功標準是當循環關閉時，影片播放一次後停止；當循環開啟時，影片持續循環。

**Acceptance Scenarios**:

1. **Given** 循環功能已開啟（預設），**When** 使用者點擊循環切換按鈕，**Then** 循環功能應關閉，並且按鈕視覺狀態應該改變以反映此狀態
2. **Given** 循環功能已關閉，**When** 影片播放到結尾，**Then** 影片應該停止，不會自動重新播放
3. **Given** 循環功能已關閉且影片已停止，**When** 使用者重新開啟循環功能並點擊播放，**Then** 影片應該開始循環播放
4. **Given** 使用者設定循環為關閉，**When** 使用者關閉應用程式並重新開啟，**Then** 循環設定應該保留為關閉狀態

---

### Edge Cases

- **無效的 YouTube 網址格式**: 當使用者貼上不是有效 YouTube 網址的文字（例如純文字、其他網站的網址）時，系統應該顯示清楚的錯誤訊息，說明需要有效的 YouTube 網址。
- **不同格式的 YouTube 網址**: 系統應該支援多種 YouTube 網址格式，包括標準格式（youtube.com/watch?v=）、短網址（youtu.be/）和嵌入格式（youtube.com/embed/）。
- **私人或受限制的影片**: 當使用者嘗試播放私人影片或在特定地區受限制的影片時，系統應該顯示友善的錯誤訊息，說明影片無法播放及原因。
- **網路連線中斷**: 如果在播放過程中網路連線中斷，系統應該顯示載入指示器，並在連線恢復時自動繼續播放。
- **超長影片**: 對於超過 2 小時的影片，循環播放功能應該仍然正常運作，不會因為影片長度而失效。
- **播放清單網址**: 當使用者貼上播放清單網址時，系統應該播放整個播放清單中的所有影片，當最後一個影片播放完畢後，自動從播放清單的第一個影片重新開始循環播放整個清單

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系統必須提供輸入欄位讓使用者貼上 YouTube 影片網址
- **FR-002**: 系統必須驗證輸入的網址是否為有效的 YouTube 影片網址格式
- **FR-003**: 系統必須支援多種 YouTube 網址格式，包括 youtube.com/watch?v=、youtu.be/ 和 youtube.com/embed/ 格式
- **FR-004**: 系統必須在使用者提交有效網址後的 3 秒內開始載入並播放影片
- **FR-005**: 系統必須在影片播放結束時自動重新開始播放（預設循環模式）
- **FR-006**: 系統必須提供暫停和播放控制按鈕
- **FR-007**: 系統必須提供音量調整控制（滑桿或按鈕）
- **FR-008**: 系統必須提供循環播放的開關按鈕
- **FR-009**: 系統必須在網址無效時顯示清楚的錯誤訊息
- **FR-010**: 系統必須在影片無法載入時（例如影片被移除、私人影片、地區限制）顯示友善的錯誤訊息
- **FR-011**: 系統必須保留使用者的音量設定，即使載入新影片或重新啟動應用程式
- **FR-012**: 系統必須保留使用者的循環開關設定，即使重新啟動應用程式
- **FR-013**: 當使用者貼上新網址時，系統必須停止當前播放的影片並載入新影片
- **FR-014**: 系統必須在載入影片時顯示視覺化的載入指示器
- **FR-015**: 系統必須支援 YouTube 播放清單網址，並能夠識別播放清單格式（例如 youtube.com/playlist?list=）
- **FR-016**: 當使用者貼上播放清單網址時，系統必須依序播放清單中的所有影片
- **FR-017**: 當播放清單中的最後一個影片播放完畢時，系統必須自動從第一個影片重新開始循環播放整個清單
- **FR-018**: 系統必須在播放清單模式下顯示當前播放進度（例如「第 3 個影片，共 10 個」）
- **FR-019**: 當播放清單中某個影片無法播放時（被移除或受限），系統必須自動跳過該影片並繼續播放下一個影片

### Key Entities

- **Video Session**: 代表目前正在播放的影片工作階段，包含影片 ID、播放狀態（播放中、暫停、載入中）、當前播放時間點、是否為播放清單模式
- **Playlist Session**: 代表播放清單工作階段（如果使用者貼上播放清單網址），包含播放清單 ID、影片 ID 列表、當前播放的影片索引、總影片數量
- **User Preferences**: 代表使用者的偏好設定，包含音量等級（0-100）、循環模式開關（開啟/關閉）、上次播放的影片 ID 或播放清單 ID（可選）
- **Playback State**: 代表播放器的即時狀態，包含是否正在播放、當前音量、是否靜音、循環模式狀態、播放清單進度（如果在播放清單模式）

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 使用者能夠在貼上 YouTube 網址後 3 秒內開始觀看影片
- **SC-002**: 90% 的使用者能夠在第一次使用時成功播放影片，無需查看說明文件或教學
- **SC-003**: 影片能夠連續循環播放至少 24 小時而不出現錯誤或停止
- **SC-004**: 所有播放控制（暫停、播放、音量）在使用者操作後 100 毫秒內提供視覺回饋
- **SC-005**: 使用者設定（音量、循環模式）在應用程式重新啟動後仍然保留，成功保留率 100%
- **SC-006**: 錯誤訊息（無效網址、影片無法載入）能夠被 95% 的使用者理解，無需技術支援
- **SC-007**: 應用程式能夠在 3G 網路環境下流暢播放 480p 影片，無明顯延遲或中斷
- **SC-008**: 系統支援所有常見的 YouTube 網址格式，格式識別成功率 100%
- **SC-009**: 播放清單能夠連續循環播放至少 10 次完整週期（整個清單從頭到尾播放 10 次）而不出現錯誤
- **SC-010**: 使用者能夠清楚識別當前正在播放清單模式，並知道播放進度（第幾個影片，共幾個）
- **SC-011**: 當播放清單中包含無法播放的影片時，系統能自動跳過並繼續播放，跳過成功率 100%

## Assumptions

以下假設在撰寫此規格時作為合理預設：

1. **播放品質**: 影片播放品質由 YouTube 服務自動決定（基於網路速度和影片可用品質），使用者在初始版本不需要手動選擇品質
2. **嵌入限制**: 假設大多數影片允許嵌入播放，對於不允許嵌入的影片將顯示錯誤訊息
3. **播放清單支援**: 系統支援 YouTube 播放清單網址，會依序播放清單中的所有影片並循環整個清單。播放清單中的影片順序由 YouTube 播放清單本身定義
4. **瀏覽器環境**: 假設應用程式將在現代網頁瀏覽器中運行，支援 HTML5 影片播放
5. **網路連線**: 假設使用者具有基本的網路連線（至少 3G 速度）來串流 YouTube 影片
6. **儲存方式**: 使用者偏好設定（音量、循環模式）使用瀏覽器本地儲存機制持久化
7. **語言**: 使用者介面和錯誤訊息預設為繁體中文
8. **YouTube API 使用**: 系統將使用 YouTube 官方提供的嵌入播放器功能
9. **播放清單大小**: 假設播放清單包含的影片數量在合理範圍內（1-200 個影片），超大型播放清單（>200 個影片）的效能表現不在初始版本的保證範圍內
10. **播放清單權限**: 假設使用者貼上的播放清單是公開或未列出（unlisted）的，私人播放清單將無法存取並顯示錯誤訊息
