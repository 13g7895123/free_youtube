# 功能規格書：播放清單與資料庫整合

**功能分支**: `002-playlist-database`  
**建立日期**: 2025-10-27  
**狀態**: 草稿  
**輸入**: 使用者描述：「加入資料庫功能以儲存影片，並建立播放清單功能，可以依據清單順序播放多個影片」

## 使用者情境與測試 *(必填)*

### 使用者故事 1 - 儲存喜愛的影片 (優先級: P1)

使用者希望能夠將喜歡的 YouTube 影片儲存到資料庫中，以便日後快速存取，無需再次搜尋或記住影片網址。

**優先級理由**: 這是建立播放清單功能的基礎。沒有儲存影片的能力，就無法建立播放清單。此功能提供最核心的價值：讓使用者保存喜愛的內容。這是從純前端工具轉變為具有持久化功能應用程式的關鍵第一步。

**獨立測試**: 可以通過新增一部影片、關閉應用程式、重新開啟後驗證影片仍然存在來測試。成功標準是影片資料被持久化儲存，且能在應用程式重啟後正確載入。

**驗收情境**:

1. **Given** 使用者正在播放一部 YouTube 影片，**When** 使用者點擊「儲存影片」或「加入我的收藏」按鈕，**Then** 影片應被儲存到資料庫，並顯示成功訊息
2. **Given** 使用者已儲存一部影片，**When** 使用者關閉應用程式後重新開啟，**Then** 先前儲存的影片應該出現在影片庫或收藏清單中
3. **Given** 使用者嘗試儲存已經存在於資料庫的影片，**When** 使用者點擊儲存，**Then** 系統應顯示訊息說明影片已存在，避免重複儲存
4. **Given** 使用者查看已儲存的影片清單，**When** 使用者點擊任一影片，**Then** 該影片應立即開始播放
5. **Given** 使用者不再喜歡某部影片，**When** 使用者選擇刪除該影片，**Then** 影片應從資料庫中移除，且不再出現在清單中

---

### 使用者故事 2 - 建立自訂播放清單 (優先級: P1)

使用者希望能夠建立多個播放清單，將相關主題或情境的影片組織在一起，例如「學習用影片」、「放鬆音樂」或「運動教學」。

**優先級理由**: 這是本功能的核心需求。播放清單讓使用者能夠組織和管理影片，遠比單純的影片庫更有價值。這直接回應使用者需求：「建立播放清單功能」。

**獨立測試**: 可以通過建立一個新播放清單、新增 3 部影片、儲存後驗證播放清單存在且包含正確影片來測試。成功標準是播放清單被正確建立並持久化儲存。

**驗收情境**:

1. **Given** 使用者開啟應用程式，**When** 使用者點擊「建立新播放清單」，**Then** 系統應提示輸入播放清單名稱，並在輸入後建立空白播放清單
2. **Given** 使用者有一個播放清單，**When** 使用者選擇「新增影片到播放清單」並貼上 YouTube 網址，**Then** 影片應被加入到該播放清單中
3. **Given** 使用者有多個播放清單，**When** 使用者瀏覽播放清單列表，**Then** 所有播放清單應以卡片或列表形式顯示，包含名稱和影片數量
4. **Given** 使用者選擇一個播放清單，**When** 使用者點擊查看，**Then** 應顯示該播放清單中所有影片的清單，包含影片縮圖、標題和時長
5. **Given** 使用者建立了一個播放清單，**When** 使用者想要修改播放清單名稱，**Then** 系統應允許編輯並儲存新名稱
6. **Given** 使用者不再需要某個播放清單，**When** 使用者選擇刪除播放清單，**Then** 系統應要求確認，確認後刪除播放清單（但不刪除影片本身）

---

### 使用者故事 3 - 依播放清單順序播放影片 (優先級: P1)

使用者希望能夠播放整個播放清單，系統會自動按照清單中的順序依序播放每一部影片。

**優先級理由**: 這是使用者明確要求的核心功能：「依據清單播放的功能」。這個功能讓播放清單真正發揮作用，而不僅僅是影片的靜態組織工具。

**獨立測試**: 可以通過建立包含 3 部影片的播放清單，點擊播放，並驗證影片按順序自動播放來測試。成功標準是播放清單中的所有影片按順序播放，無需手動切換。

**驗收情境**:

1. **Given** 使用者有一個包含多部影片的播放清單，**When** 使用者點擊「播放清單」按鈕，**Then** 播放清單的第一部影片應開始播放
2. **Given** 播放清單正在播放，**When** 當前影片結束，**Then** 下一部影片應自動開始播放，無需使用者介入
3. **Given** 播放清單播放到最後一部影片，**When** 最後一部影片結束，**Then** 系統應自動從第一部影片重新開始（循環播放整個清單）
4. **Given** 使用者正在播放播放清單，**When** 使用者想要跳到下一首或上一首，**Then** 系統應提供「下一首」和「上一首」按鈕，點擊後立即切換影片
5. **Given** 使用者正在播放播放清單，**When** 使用者想要跳到特定影片，**Then** 使用者應能從播放清單中點擊任意影片，該影片立即開始播放
6. **Given** 播放清單正在播放，**When** 使用者查看播放介面，**Then** 應清楚顯示當前播放的是哪一部影片（例如：「正在播放: 3/10」）

---

### 使用者故事 4 - 管理播放清單中的影片順序 (優先級: P2)

使用者希望能夠調整播放清單中影片的播放順序，以符合個人偏好或情境需求。

**優先級理由**: 雖然不是最核心功能，但此功能大幅提升播放清單的實用性。使用者可能希望調整影片順序以創造更好的播放流程，例如將喜愛的影片放在前面。

**獨立測試**: 可以通過在播放清單中拖曳影片改變順序，然後播放清單驗證播放順序是否已更新來測試。成功標準是影片順序改變後被正確儲存並反映在播放順序中。

**驗收情境**:

1. **Given** 使用者查看播放清單中的影片，**When** 使用者拖曳影片到新位置，**Then** 影片順序應立即更新並儲存
2. **Given** 使用者在播放清單中選擇一部影片，**When** 使用者點擊「上移」或「下移」按鈕，**Then** 影片應在清單中移動一個位置
3. **Given** 使用者調整了播放清單順序，**When** 使用者播放該清單，**Then** 影片應按照新順序播放
4. **Given** 使用者想要快速調整順序，**When** 使用者選擇「移到最前」或「移到最後」，**Then** 影片應立即移動到清單的第一位或最後一位

---

### 使用者故事 5 - 搜尋與篩選已儲存的影片 (優先級: P3)

當影片庫變大時，使用者希望能夠快速搜尋或篩選影片，以找到特定內容。

**優先級理由**: 這是增強功能，當使用者擁有大量影片時才變得重要。在初期階段，使用者影片數量較少，此功能優先級較低。

**獨立測試**: 可以通過儲存 20 部影片，然後使用搜尋功能找到特定影片來測試。成功標準是搜尋結果準確且即時更新。

**驗收情境**:

1. **Given** 使用者有多部已儲存的影片，**When** 使用者在搜尋欄輸入關鍵字，**Then** 系統應即時顯示標題或描述包含該關鍵字的影片
2. **Given** 使用者想要查看特定播放清單的影片，**When** 使用者選擇播放清單篩選器，**Then** 只有該播放清單中的影片應被顯示
3. **Given** 搜尋結果顯示多部影片，**When** 使用者清除搜尋欄，**Then** 應恢復顯示所有影片

---

### 使用者故事 6 - 顯示影片資訊和縮圖 (優先級: P2)

使用者希望在影片清單中看到影片的縮圖、標題和時長，以便快速識別內容。

**優先級理由**: 這大幅提升使用者體驗，讓影片庫和播放清單更易於瀏覽。雖然不是核心功能，但對於建立專業品質的應用程式很重要。

**獨立測試**: 可以通過儲存影片並驗證縮圖、標題和時長是否正確顯示來測試。成功標準是所有影片資訊準確呈現。

**驗收情境**:

1. **Given** 使用者儲存一部 YouTube 影片，**When** 影片被加入資料庫，**Then** 系統應自動抓取並儲存影片的縮圖、標題、時長和頻道名稱
2. **Given** 使用者瀏覽影片清單或播放清單，**When** 查看清單，**Then** 每部影片應顯示縮圖、標題和時長
3. **Given** 影片縮圖載入失敗，**When** 系統無法取得縮圖，**Then** 應顯示預設的占位圖片，不影響其他功能

---

### 邊界案例

- **空播放清單**: 當使用者嘗試播放空白播放清單時，系統應顯示友善訊息，說明播放清單目前沒有影片，並提示如何新增影片。
- **影片被刪除**: 當播放清單中的某部 YouTube 影片被原作者刪除或設為私人時，系統應在該影片位置顯示錯誤訊息，並自動跳到下一部影片繼續播放。
- **大量影片**: 當播放清單包含超過 100 部影片時，系統應使用分頁或虛擬滾動來維持效能，避免載入時間過長。
- **重複影片**: 使用者可能希望在同一播放清單中多次加入相同影片（例如特別喜歡的歌曲），系統應允許這種情況，而不是自動去重。
- **資料庫遷移**: 當使用者更換裝置或瀏覽器時，應提供匯出和匯入資料的功能，讓使用者能夠轉移播放清單資料。
- **離線存取**: 雖然影片本身需要網路連線播放，但播放清單結構和影片資訊應能在離線狀態下瀏覽（僅無法播放）。
- **並行編輯**: 當使用者在多個瀏覽器分頁同時編輯同一播放清單時，系統應能正確處理資料同步，避免資料遺失。

## 需求 *(必填)*

### 功能需求

- **FR-001**: 系統必須提供將當前播放影片儲存到資料庫的功能
- **FR-002**: 系統必須儲存每部影片的基本資訊，包含：影片 ID、標題、縮圖網址、時長、頻道名稱、儲存時間
- **FR-003**: 系統必須提供刪除已儲存影片的功能
- **FR-004**: 系統必須防止同一影片被重複儲存（相同影片 ID 只能儲存一次到影片庫）
- **FR-005**: 系統必須提供建立新播放清單的功能，需要使用者輸入播放清單名稱
- **FR-006**: 系統必須允許使用者編輯播放清單名稱
- **FR-007**: 系統必須允許使用者刪除播放清單，刪除前需要確認
- **FR-008**: 系統必須提供將影片新增到指定播放清單的功能
- **FR-009**: 系統必須允許同一影片被加入多個不同的播放清單
- **FR-010**: 系統必須允許同一影片在同一播放清單中出現多次（支援重複播放）
- **FR-011**: 系統必須提供從播放清單中移除影片的功能
- **FR-012**: 系統必須記錄播放清單中影片的順序
- **FR-013**: 系統必須提供調整播放清單中影片順序的功能（上移、下移、拖曳）
- **FR-014**: 系統必須提供播放整個播放清單的功能，按順序自動播放所有影片
- **FR-015**: 系統必須在播放清單播放時提供「下一首」和「上一首」控制按鈕
- **FR-016**: 系統必須在播放清單的最後一部影片結束後，自動回到第一部影片重新播放（循環模式）
- **FR-017**: 系統必須顯示當前正在播放的影片在播放清單中的位置（例如：3/10）
- **FR-018**: 系統必須顯示所有播放清單的列表，包含播放清單名稱和影片數量
- **FR-019**: 系統必須顯示播放清單中所有影片的清單，包含縮圖、標題和時長
- **FR-020**: 系統必須提供搜尋已儲存影片的功能，支援標題關鍵字搜尋
- **FR-021**: 系統必須使用本地儲存技術（LocalStorage 或 IndexedDB）持久化所有資料
- **FR-022**: 系統必須在應用程式啟動時載入所有已儲存的影片和播放清單資料
- **FR-023**: 系統必須在資料變更時即時更新儲存，確保不會因為瀏覽器關閉而遺失資料

### 關鍵實體 *(包含資料相關功能)*

- **影片 (Video)**: 代表一部 YouTube 影片，包含影片 ID、標題、縮圖網址、時長、頻道名稱、YouTube 網址、儲存時間戳記。每部影片在影片庫中唯一，但可以被多個播放清單引用。
- **播放清單 (Playlist)**: 代表使用者建立的影片集合，包含播放清單 ID、名稱、建立時間、最後修改時間。一個播放清單可以包含多部影片，且同一影片可以在清單中出現多次。
- **播放清單項目 (PlaylistItem)**: 代表播放清單中的一個影片項目，包含項目 ID、播放清單 ID、影片 ID、順序位置。這個實體建立播放清單與影片之間的多對多關係，並記錄影片在清單中的順序。

## 成功標準 *(必填)*

### 可衡量成果

- **SC-001**: 使用者可以在 5 秒內將影片儲存到資料庫，並在應用程式重啟後成功載入
- **SC-002**: 使用者可以在 30 秒內建立一個包含 5 部影片的播放清單
- **SC-003**: 播放清單播放功能能夠順暢地自動播放至少 10 部影片，無需使用者手動操作
- **SC-004**: 影片順序調整（拖曳或按鈕）的回應時間少於 1 秒，使用者能立即看到變化
- **SC-005**: 系統能夠儲存至少 1000 部影片和 50 個播放清單而不影響效能（載入時間少於 3 秒）
- **SC-006**: 搜尋功能能在 500 毫秒內返回結果，即使影片庫包含 500 部影片
- **SC-007**: 90% 的使用者能在首次使用時成功建立播放清單並播放，無需查看說明文件
- **SC-008**: 資料持久化成功率達到 99.9%，使用者不會因為瀏覽器關閉而遺失資料
- **SC-009**: 影片縮圖和資訊的載入成功率達到 95% 以上
- **SC-010**: 播放清單播放時，影片切換的延遲時間少於 2 秒

## 假設 *(選填)*

- 使用者主要使用桌面瀏覽器或行動裝置的現代瀏覽器（支援 LocalStorage 和 IndexedDB）
- 使用者擁有穩定的網路連線以播放 YouTube 影片
- 影片的 metadata（標題、縮圖、時長等）可以透過 YouTube IFrame API 或公開的 YouTube Data API 取得
- 使用者不需要跨裝置同步資料（在 MVP 階段，資料僅儲存在本地）
- 影片庫和播放清單資料大小不會超過瀏覽器本地儲存的限制（通常為 5-10 MB）
- 使用者能夠接受純前端實作，不需要後端伺服器或使用者帳戶系統

## 排除範圍 *(選填)*

以下功能明確排除在本次規格之外，可能在未來版本中考慮：

- 後端伺服器整合和雲端資料同步
- 使用者帳戶系統和多裝置同步
- 社交功能（分享播放清單、協作編輯）
- 播放清單匯出為 YouTube 播放清單
- 進階播放功能（隨機播放、重複單曲）
- 影片下載或離線播放功能
- 播放歷史記錄和統計分析
- 自訂播放清單封面圖片
- 播放清單分類或標籤系統
- 影片評分或評論功能

## 相依性 *(選填)*

- **技術相依**: 需要 YouTube IFrame Player API 支援基本播放功能（已在 001-youtube-loop-player 中實作）
- **功能相依**: 本功能建立在 001-youtube-loop-player 的基礎上，需要該功能的播放器和基本控制功能
- **資料相依**: 需要能夠存取 YouTube 影片的 metadata（可能需要 YouTube Data API v3 或透過第三方服務）
- **瀏覽器相依**: 需要瀏覽器支援 LocalStorage 或 IndexedDB API

## 風險與挑戰 *(選填)*

- **本地儲存限制**: 瀏覽器的 LocalStorage 有容量限制（通常 5-10 MB），大量影片可能超出限制。緩解策略：使用 IndexedDB 以獲得更大儲存空間，並在接近限制時警告使用者。
- **YouTube API 限制**: YouTube Data API 有每日請求配額限制。緩解策略：快取影片 metadata，僅在必要時請求；或使用第三方服務/爬蟲替代方案。
- **資料遺失風險**: 使用者可能清除瀏覽器資料導致播放清單遺失。緩解策略：提供匯出/匯入功能，讓使用者能夠備份資料。
- **效能問題**: 大量影片（超過 1000 部）可能導致載入和渲染變慢。緩解策略：使用虛擬滾動、分頁和延遲載入技術。
- **跨瀏覽器相容性**: 不同瀏覽器對 IndexedDB 的實作可能有差異。緩解策略：使用成熟的資料庫封裝函式庫（如 Dexie.js 或 localForage）。
